# -*- mode: makefile; -*-

#------------------------------------------------------------------------------

#CFLAGS= -g -Wall
CFLAGS= -O3 -ffast-math -fno-rtti -Wall -DNDEBUG

INSTALLDIR= $(HOME)/bin

#------------------------------------------------------------------------------

CH= install_name_tool -change
CC= g++

#------------------------------------------------------------------------------

ifeq "$(MAKE)" "mingw32-make"
	RM= del
        CP= copy
else
	RM= rm -f
        CP= cp
endif

#------------------------------------------------------------------------------

LIBSDL  = /usr/local/lib/libSDLmain.a /usr/local/lib/libSDL.a
LIBFT   = /usr/local/lib/libfreetype.a
LIBTIF  = /usr/local/lib/libtiff.a
LIBGLEW = /usr/local/lib/libGLEW.a
LIBMXML = /usr/local/lib/libmxml.a
LIBODE  = /usr/local/lib/libode.a
LIBJPG  = /usr/local/lib/libjpeg.a
LIBPNG  = /usr/local/lib/libpng15.a
LIBZ    = /usr/local/lib/libz.a
LIBBZ2  = -lbz2

#------------------------------------------------------------------------------

ifeq ($(shell uname), Darwin)
	TARG    = libthumb.dylib
	LD      = g++ -dynamiclib
	SDLCONF = sdl-config
	FT2CONF = freetype-config
	LIBEXT  = -framework OpenGL -framework Cocoa -framework ApplicationServices -framework Carbon -framework AudioToolbox -framework AudioUnit -framework IOKit
else
	TARG    = libthumb.so
	LD      = g++ -shared
	SDLCONF = sdl-config
	FT2CONF = freetype-config
	LIBEXT  = -lGL
endif

#------------------------------------------------------------------------------

# Use user include and lib directories if they exist.

ifneq ($(wildcard $(HOME)/include),)
	INCDIR += -I$(HOME)/include
endif
ifneq ($(wildcard $(HOME)/lib),)
	LIBDIR += -L$(HOME)/lib
endif

#------------------------------------------------------------------------------

%.d : %.cpp
	$(CC) $(CFLAGS) $(INCDIR) -MM -MF $@ -MT $*.o $<

%.o : %.cpp
	$(CC) $(CFLAGS) $(INCDIR) -c $< -o $@

#------------------------------------------------------------------------------
