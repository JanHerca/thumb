<html>
  <head>
    <title>Orbiter</title>
    <style>
      body {
        margin: 10% 15% 10% 15%;
      }
      h1, h2, h3 {
        margin-left: -5%;
      }
      p {
        text-align: justify;
        line-height: 140%;
      }
      code {
        font-family: inherit;
        font-style: italic;
        font-size: inherit;
      }
      table, thead, tbody, tr, td, th {
        font-size: inherit;
        font-family: inherit;
        line-height: 150%;
      }
      img {
        display: block;
        margin-left: auto;
        margin-right: auto;
      }
      #spreadsheet {
        border-collapse:collapse;
        margin-left:auto;
        margin-right:auto;
      }
      #spreadsheet td {
        border: 1px solid black;
        width: 4em;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>Orbiter</h1>

    <p>&copy; 2012 Robert L. Kooima &mdash; <i>kooima&#64;csc&#46;lsu&#46;edu</i></p>

    <p>This document describes the use of the <code>Orbiter</code> real-time planetary visualization package and a few of the details of the spherical cube map (SCM) data file format that supports it. <code>Orbiter</code> is implemented using the <code>Thumb</code> framework, and pertinent aspects of <code>Thumb</code> are also documented here.</p>

    <ul>
      <li><a href="#usage">Usage</a></li>
      <ul>
        <li><a href="#interaction">Interaction</a></li>
        <ul>
          <li><a href="#viewing">Viewing Controls</a></li>
          <li><a href="#metadata">Metadata Controls</a></li>
          <li><a href="#editing">Camera Path Editing</a></li>
          <li><a href="#recording">Camera Path Recording</a></li>
        </ul>
        <li><a href="#appconf">Application Configuration</a></li>
        <li><a href="#datconf">Data Configuration</a></li>
        <li><a href="#definition">Planet Definition XML</a></li>
        <li><a href="#goto">Go-To</a></li>
        <li><a href="#labels">Planet Feature Labeling</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
      <li><a href="#scm">SCM TIFF</a></li>
    </ul>

    <a name="usage"><h2>Usage</h2></a>

    <p>The <code>Orbiter</code> application may be run from the command line or double-clicked in the Finder or Explorer. Under many circumstances, launching <code>Orbiter</code> from the command line is best.</p>

    <blockquote><pre>./orbiter</pre></blockquote>

    <p>There are a number of display modes configured in the default host definition file <tt>data/host/common.xml</tt>. One of these configurations may be selected on the command line. For example, HD resolution:</p>

    <blockquote><pre>./orbiter 1920x1080</pre></blockquote>

    <p>&hellip; or left-right stereoscopic display on a 3D HDTV:</p>

    <blockquote><pre>./orbiter 1920x1080-LR</pre></blockquote>

    <p>&hellip; or fulldome using a 1024 &times; 768 projector::</p>

    <blockquote><pre>./orbiter fulldome-1024x768</pre></blockquote>

    <a name="interaction"><h3>Interaction</h3></a>

    On launch, <code>Orbiter</code> presents a menu of prepared visualizations to be browsed, selected, and loaded.</p>

    <img src="img/select.png">

    <p>Note, this is <em>not</em> a list of available data files. A planetary visualization is usually a composition of several distinct data sets in <a href="#scm">SCM TIFF</a> format, and the <code>Orbiter</code> file selection dialog lists the XML files that define these visualizations. The XML files are found in the <tt>data/scm</tt> directory in the <code>Thumb</code> distribution, and are <a href="#definition">described below</a>.</p>

    <p>Loading a visualization closes the selection dialog and displays the planet. Here, we've selected <tt>GLD-WAC.xml</tt> and zoomed in a bit, as described next.</p>

    <img src="img/view.png">

    <a name="viewing"><h4>Viewing Controls</h4></a>

    <p>The default mechanism for interaction with <code>Orbiter</code> uses the keyboard and a two-button mouse.

    <table style="margin:auto;width:80%">
      <tr>
        <th style="width:25%">Button</th>
        <th style="width:5%"></th>
        <th style="width:70%">Function</th>
      </tr>
      <tr>
        <td>Left Mouse</td>
        <td>&hellip;</td>
        <td>Click and drag to change view position (rotate the planet).</td>
      </tr>
      <tr>
        <td>Right Mouse</td>
        <td>&hellip;</td>
        <td>Click and drag to change view altitude</td>
      </tr>
      <tr>
        <td>Shift Left Mouse</td>
        <td>&hellip;</td>
        <td>Click and drag to change view direction (rotate the camera).</td>
      </tr>
      <tr>
        <td>Shift Right Mouse</td>
        <td>&hellip;</td>
        <td>Click and drag to change lighting direction.</td>
      </tr>
    </table>

    <p>Not all visualizations support dynamic lighting, so the effects of shift-right-click might not always be apparent.</p>

    <a name="metadata"><h4>Metadata Controls</h4></a>

    <p>Informational overlays and debug views may be toggled using function keys. The File Selection toggle allows the visualization to be changed at any time. The camera path display enables camera script editing. The label toggle displays information for over 8000 craters on the moon. The remaining displays are mostly for debugging the 3D renderer, but they do also look cool.</p>

    <table style="margin:auto;width:80%">
      <tr>
        <th style="width:15%">Key</th>
        <th style="width:5%"></th>
        <th style="width:80%">Function</th>
      </tr>
      <tr>
        <td>F1</td>
        <td>&hellip;</td>
        <td>Toggle the <a href="#usage">File Selection</a> dialog.</td>
      </tr>
      <tr>
        <td>F2</td>
        <td>&hellip;</td>
        <td>Toggle cache overlay.</td>
      </tr>
      <tr>
        <td>F3</td>
        <td>&hellip;</td>
        <td>Toggle the label display.</td>
      </tr>
      <tr>
        <td>F4</td>
        <td>&hellip;</td>
        <td>Toggle the <a href="#editing">camera path</a> display.</td>
      </tr>
      <tr>
        <td>F5</td>
        <td>&hellip;</td>
        <td>Toggle wireframe display.</td>
      </tr>
      <tr>
        <td>F6</td>
        <td>&hellip;</td>
        <td>Toggle the bounding volume display.</td>
      </tr>
    </table>

    <a name="editing"><h4>Camera Path Editing</h4></a>

    <p><code>Orbiter</code> allows the position and orientation of the camera to follow a pre-determined path, determined by a series of key frames. These key frames are specified interactively and keyboard commands insert or append the current camera configuration to a storable list of camera configurations. These key frames are animated using Hermite interpolation. The camera path visualization is toggled using the F4 key. Here is an example:</p>

    <img src="img/path.png">

    <p>The orange squares denote key frames and the green line shows their interpolation. The green key square is the first and the red key square is the last. The yellow key square indicates the current key frame selected for editing. The small green dots indicate the speed of the path, with each dot representing one quarter of a second.</p>

    <table style="margin:auto;width:80%">
      <tr>
        <th style="width:20%">Key</th>
        <th style="width:5%"></th>
        <th style="width:75%">Function</th>
      </tr>
      <tr>
        <td>Control-<u>A</u></td>
        <td>&hellip;</td>
        <td><u>A</u>dd the current camera position into the path <em>after</em> the current key.</td>
      </tr>
      <tr>
        <td>Control-<u>I</u></td>
        <td>&hellip;</td>
        <td><u>I</u>nsert the current camera position into the path <em>before</em> the current key.</td>
      </tr>
      <tr>
        <td>Control-<u>O</u></td>
        <td>&hellip;</td>
        <td><u>O</u>verwrite the current camera position onto the current key.</td>
      </tr>
      <tr>
        <td>Control-<u>D</u></td>
        <td>&hellip;</td>
        <td><u>D</u>elete the current key from the path.</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>Control-<u>N</u></td>
        <td>&hellip;</td>
        <td>Select the <u>N</u>ext path key.</td>
      </tr>
      <tr>
        <td>Control-<u>P</u></td>
        <td>&hellip;</td>
        <td>Select the <u>P</u>revious path key.</td>
      </tr>
      <tr>
        <td>Control-<u>R</u></td>
        <td>&hellip;</td>
        <td><u>R</u>ewind the current key and the play-back position to the beginning.</td>
      </tr>
      <tr>
        <td>Control-<u>J</u></td>
        <td>&hellip;</td>
        <td><u>J</u>ump the camera to the current key position.</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>Control-<u>F</u></td>
        <td>&hellip;</td>
        <td>Play the path <u>F</u>orward from the current play-back position.</td>
      </tr>
      <tr>
        <td>Control-<u>B</u></td>
        <td>&hellip;</td>
        <td>Play the path <u>B</u>ackward from the current play-back position.</td>
      </tr>
      <tr>
        <td>Spacebar</td>
        <td>&hellip;</td>
        <td>Stop play-back.</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>Control-<u>S</u></td>
        <td>&hellip;</td>
        <td><u>S</u>ave the path to a file.</td>
      </tr>
      <tr>
        <td>Control-<u>L</u></td>
        <td>&hellip;</td>
        <td><u>L</u>oad the path from a file.</td>
      </tr>
      <tr>
        <td>Control-<u>C</u></td>
        <td>&hellip;</td>
        <td><u>C</u>lear the path, removing all keys.</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>Up</td>
        <td>&hellip;</td>
        <td>Increase the camera speed at the current key.</td>
      </tr>
      <tr>
        <td>Down</td>
        <td>&hellip;</td>
        <td>Decrease the camera speed at the current key.</td>
      </tr>
      <tr>
        <td>Control Up</td>
        <td>&hellip;</td>
        <td>Increase the tension of the camera path following the current key.</td>
      </tr>
      <tr>
        <td>Control Down</td>
        <td>&hellip;</td>
        <td>Decrease the tension of the camera path following the current key.</td>
      </tr>
      <tr>
        <td>Shift Up</td>
        <td>&hellip;</td>
        <td>Shift the bias of the camera path toward the next key.</td>
      </tr>
      <tr>
        <td>Shift Down</td>
        <td>&hellip;</td>
        <td>Shift the bias of the camera path toward the current key.</td>
      </tr>
    </table>

    <p>Some tips:</p>

    <ul>
      <li><p>To prepare a camera path, navigate normally and press Control-A at each point of interest. This will append each point to the list, moving the current selection forward with each addition.</p></li>

      <li><p>Press Control-R to rewind to the beginning and press Control-F to animate the path forward.</p></li>

      <li><p>Gain some altitude or distance to see an overview of the path.</p></li>

      <li><p>If a particular key frame is bad or wrong, select it using Control-P and Control-N, press Control-J to jump to that view point, and adjust the camera interactively. When the view point is improved, press Control-O to overwrite the current position onto the bad key frame.</p></li>

      <li><p>This gets easier with practice. Always try to be aware of which key is current. The path visualizion is updated as it is edited, so keep an eye on subtle changes down the line caused by local modifications. It often helps to work backwards.</p></li>

      <li><p>Cubic interpolation can give unexpected results, particularly before and after wide gaps between keys. Path tension adjustments can help, but do plan ahead.</p></li>

      <li><p>Press Control-S to save the current path to disk, or Control-L to load it from disk. <b>Note:</b> There is currently no file name selection dialog for path storage. The file is <em>always</em> named <tt>path.xml</tt>. It is found in the <code>Thumb</code> user filesystem, usually in <tt>~/.thumb/</tt>, but failing that in the current working directory. If you wish to store multiple path files, please use the Finder or Explorer to rename <tt>path.xml</tt> by hand after saving, or before loading.</p></li>
    </ul>

    <a name="recording"><h4>Camera Path Recording</h4></a>

    <p>Once a suitable path has been defined, it may be rendered to an image sequence.</p>

    <table style="margin:auto;width:80%">
      <tr>
        <th style="width:20%">Key</th>
        <th style="width:5%"></th>
        <th style="width:70%">Function</th>
      </tr>
      <tr>
        <td>Shift-Control-<u>F</u></td>
        <td>&hellip;</td>
        <td>Record the path <u>F</u>orward from the current play-back position.</td>
      </tr>
      <tr>
        <td>Shift-Control-<u>B</u></td>
        <td>&hellip;</td>
        <td>Record the path <u>B</u>ackward from the current play-back position.</td>
      </tr>
    </table>

    <p>This will produces a series of PNG files in the current working directory named <tt>frame00000.png</tt>, <tt>frame00001.png</tt>, etc, representing a 30-frame per second animation of the path. This may take some time. Unlike during interactive rendering, <code>Orbiter</code> takes the time to ensure optimal image quality. It waits for each necessary page of SCM data to be fully loaded from disk into VRAM before rendering and storing each frame.</p>

    <p>If the path play-back is stopped for any reason, the recording stops as well.</p>

    <a name="appconf"><h3>Application Configuration</h3></a>

    <p><code>Thumb</code> configuration options reside in the file <tt>data/conf.xml</tt>.</p>

    <ul>
      <li><p>The cache size option limits the total number of SCM pages that may be loaded simultaneously. It allows the renderer to be tuned to make maximal use of available GPU resources and thus impacts the behavior and performance of the renderer. As the cache is two-dimensional, the exact page count is the square of the cache size. Thus, the default, 16, allows 256 pages per cache.</p></li>

      <blockquote><pre>&lt;option name="scm_cache_size"&gt;16&lt;/option&gt;</pre></blockquote>

      <li><p>The report host option gives the host name (or dotted quad) and port number of a host waiting to receive a streaming report of the renderer's current view position. This port will receive a single UDP packet per frame containing an ASCII string giving the longitude and latitude of the view position in degrees and the radius of the viewpoint in meters. This string is terminated by a newline and a null byte.</p></li>

      <blockquote><pre>&lt;option name="orbiter_report_host"&gt;127.0.0.1&lt;/option&gt;
&lt;option name="orbiter_report_port"&gt;8111&lt;/option&gt;</pre></blockquote>

      <li><p>The joystick options select the joystick device number, axis indices for the X and Y axes, button numbers for motion up and down, and a deadzone size (0.0 to 1.0) for analog gamepads with unreliable centering.</p></li>

      <blockquote><pre>&lt;option name="orbiter_joystick_device"&gt;0&lt;/option&gt;
&lt;option name="orbiter_joystick_axis_X"&gt;0&lt;/option&gt;
&lt;option name="orbiter_joystick_axis_Y"&gt;1&lt;/option&gt;
&lt;option name="orbiter_joystick_button_U"&gt;0&lt;/option&gt;
&lt;option name="orbiter_joystick_button_D"&gt;1&lt;/option&gt;
&lt;option name="orbiter_joystick_deadzone"&gt;0.25&lt;/option&gt;</pre></blockquote>

      <li><p>The icon size option selects the size of the icons used in <a href="#labels">feature labeling</a>, in pixels. Increasing this value will make these icons more visible on large, high-resolution displays. For best quality, use a power of two.</p></li>

      <blockquote><pre>&lt;option name="orbiter_icon_size"&gt;16&lt;/option&gt;</pre></blockquote>

      <li><p>The goto radius option selects distance from the planet to which the camera moves during a <a href="#goto">goto</a> operation. If set to zero, then the midpoint of the starting and ending positions is used.</p></li>

      <blockquote><pre>&lt;option name="orbiter_goto_radius"&gt;2000000.0&lt;/option&gt;</pre></blockquote>

    </ul>

    <a name="datconf"><h3>Data Configuration</h3></a>

    <p>The shell environment variable <tt>SCMPATH</tt> lists directories where SCM TIFF files may be found. Set this variable in the shell resource file just as one might set the shell path, separated by colons. (Or semi-colons under Windows, as C: is a valid part of a Windows path.) For example,</p>

    <blockquote><pre>export SCMPATH=/share/scm:$HOME/Data/scm:.</pre></blockquote>

    <p>The environment variable <tt>SCMINIT</tt> optionally gives the name of a visualization definition file to be loaded immediately upon launch. If specified, <code>Orbiter</code> will not present the file selection dialog and will instead proceed directly to displaying the named file. For example,</p>

    <blockquote><pre>export SCMINIT=scm/GLD-WAC.xml</pre></blockquote>

    <a name="definition"><h3>Planet Definition XML</h3></a>

    <p>The planet visualization definition file lists the SCM files that comprise each visualization, as well as the parameters of the planet and the mechanisms of its rendering. An understanding of these files is not necessary for basic use of <code>Orbiter</code>, but if customized visualizations are to be created then the file's contents must be understood. For a complete accounting of this file format, see the full SCM TIFF documentation.</p>

    <p>Planet definition XML files appear in an abstract file system used by the <code>Thumb</code> framework. To be visible to <code>Orbiter</code>, they must be placed in the <tt>data</tt> directory within the application directory, or in one of the directories listed in the <tt>THUMB_RO_PATH</tt> environment variable. These files need <em>not</em> be stored along side the SCM TIFF files that they reference.</p>

    <p>Here is an example of a basic planet definition, <tt>GLD-WAC.xml</tt>.</p>

<blockquote><pre>
&lt;?xml version="1.0"?&gt;
  &lt;sphere radius="1737400.0"
            mesh="32"
            size="426"
            vert="glsl/scm-displace.vert"
            frag="glsl/scm-basic.frag"&gt;

    &lt;cache n="426" c="1" b="8"  threads="2"/&gt;
    &lt;cache n="426" c="1" b="16" threads="2" r0="0.994728" r1="1.0062" /&gt;

    &lt;frame&gt;
      &lt;image name="height" scm="DTM-426-6.tif" cache="1" height="1"/&gt;
      &lt;image name="color"  scm="WAC-426-6.tif" cache="0" /&gt;
    &lt;/frame&gt;

    &lt;step name="Tycho"
         label="csv/Tycho.csv"
            q0=" 0.762239" q1="-0.085507" q2="-0.161517" q3=" 0.620961"
            p0="-0.159228" p1="-0.719553" p2=" 0.675936"  r="1794686.446486" /&gt;
    &lt;step name="Copernic"
         label="csv/Copernic.csv"
            q0=" 0.089011" q1="-0.228597" q2="-0.496265" q3=" 0.832792"
            p0="-0.357236" p1=" 0.156369" p2=" 0.920832"  r="1991161.296438" /&gt;
  &lt;/sphere&gt;
</pre></blockquote>


    <p>The file begins with an XML header and contains a single root <tt>sphere</tt> element with several attributes and one <tt>image</tt> sub-element for each SCM TIFF image.</p>

    <ul>
      <li><p>The <tt>mesh</tt> attribute determines the tessellation of the geometry mesh used to render each page of data. The example value, 32, indicates that each page of the sphere will be rendered using a 32 &times; 32 grid of squares.</p></li>

      <li><p>The <tt>radius</tt> attribute determines the base radius of the sphere, in meters. In this example, the moon has a radius of 1737000 meters.</p></li>

      <li><p>The <tt>size</tt> attribute gives the size of each page in the referenced SCM TIFFs. Note that the value coincides with the image parameters given by the SCM file names. Other values are allowed, and may enable quality-speed tradeoffs.</p></li>

      <li><p>The <tt>vert</tt> and <tt>frag</tt> attributes give the vertex and fragment programs to be used by the renderer, named relative to the root of the Thumb data hierarchy. In this case, the &ldquo;displacement&rdquo; vertex shader is used to render displacement-mapped terrain, and the &ldquo;basic&rdquo; fragment shader is used to apply a simple image to the resulting surface. These attributes will remain the same for most planet definitions, though different lighting models, overlay modes, and data visualizations may be introduced using alternate shaders.</p></li>

      <li><p>The <tt>cache</tt> elements define data storage for image data to be stored. Each cache is defined by the size and type of data that it can store, and includes optional configuration for loader thread configuration and height map normalization.</p></li>

      <li><p>The <tt>frame</tt> elements group images into separate visualizations which can be individually selected within the application.</p></li>

      <li><p>The <tt>image</tt> elements name the actual SCM data files. In this example, <tt>DTM-426-6.tif</tt> gives a Digital Terrain Model, which acts as a height map. Because it serves to modify the geometry of the spherical mesh, it is fed to the vertex shader and its normalized minimum and maximum radii are provided as attributes. <tt>WAC-426-6.tif</tt> is a simple image file fed to the fragment shader. Each image has a name that identifies it the rendering shader, and each includes the index of a cache capable of storing it.</p></li>

      <li><p>The <tt>step</tt> elements define the view parameters for regions of interest for use by the <a href="#goto">go-to mechanism</a>. These are the exact same data structure as found in the <tt>path.xml</tt> file used by the <a href="#editing">camera path</a> storage mechanism.</p></li>
    </ul>

    <p>Here's another example, <tt>NAC_ROI.xml</tt>, that includes two high-resolution overlays configured as separate <tt>frame</tt> elements. Note in this case that the <tt>path</tt> elements include frame indices, which cause the visualization to be automatically selected when a <a href="#goto">go-to</a> is activated</p>

<blockquote><pre>
&lt;?xml version="1.0"?&gt;
  &lt;sphere radius="1737400.0"
            mesh="32"
            size="336"
            vert="glsl/scm-displace.vert"
            frag="glsl/scm-overlay.frag"&gt;

    &lt;cache n="426" c="1" b="8"  threads="2"/&gt;
    &lt;cache n="336" c="1" b="8"  threads="2"/&gt;
    &lt;cache n="426" c="1" b="16" threads="2" r0="0.994728" r1="1.0062" /&gt;

    &lt;frame&gt;
      &lt;image name="height" scm="DTM-426-6.tif"       height="1" cache="2" /&gt;
      &lt;image name="base"   scm="WAC-426-6.tif"                  cache="0" /&gt;
      &lt;image name="over"   scm="NAC_ROI_TychoCtrLoA-336-14.tif" cache="1" /&gt;
    &lt;/frame&gt;
    &lt;frame&gt;
      &lt;image name="height" scm="DTM-426-6.tif"       height="1" cache="2" /&gt;
      &lt;image name="base"   scm="WAC-426-6.tif"                  cache="0" /&gt;
      &lt;image name="over"   scm="NAC_ROI_Apollo16HiA-336-14.tif" cache="1" /&gt;
    &lt;/frame&gt;

    &lt;step name="Tycho"
         frame="0"
         label="csv/Tycho.csv"
            q0=" 0.762239" q1="-0.085507" q2="-0.161517" q3="0.620961"
            p0="-0.159228" p1="-0.719553" p2=" 0.675936"  r="1794686.446486" /&gt;
    &lt;step name="Apollo16"
         frame="1"
         label="csv/IAUMOON.csv"
            q0=" 0.106962" q1=" 0.140275" q2="-0.017893" q3="0.984155"
            p0=" 0.263982" p1="-0.156004" p2=" 0.951828"  r="1737876.083148" /&gt;
  &lt;/sphere&gt;
</pre></blockquote>

    <a name="goto"><h3>Go-To</h3></a>

    <p><code>Orbiter</code> supports a &ldquo;go-to&rdquo; mechanism that allows an external application to programmatically direct the view point to one of the regions of interested given in the planet definition XML file.</p>

    <p>Go-to messages are received on port 2829. Each message consists of a single UDP datagram containing an ASCII name string which is matched against the <tt>name</tt> attribute of the <tt>step</tt> element. Only the <em>first eight characters</em> of this string are used.</p>

    <p>For example, a message meeting these requirements can be generated using the command line tool <tt>ncat</tt> as follows:</p>

    <blockquote><pre>echo -n "Copernic" | ncat -u --send-only 127.0.0.1 2829</pre></blockquote>

    <p>Upon message receipt, the renderer interpolates the viewpoint to the selected position using the same internal mechanism as the <a href="#editing">camera path definition</a>. Note, therefore, that the receipt of a go-to message will replace any currently-loaded camera path definition. Likewise, after a go-to has executed, its path remains and may be reviewed, modified, and stored using the camera path editing interface.</p>

    <p>This commonality may be exploited, and points of interest may be defined simply by copy-pasting <tt>step</tt> elements from <tt>path.xml</tt> into the planet definition XML. The <tt>q</tt> attributes give the view orientation in the form of a quaternion, the <tt>p</tt> attributes give the view position as a normalized direction vector, and the <tt>r</tt> attribute gives the view radius, or distance from the center of the sphere. A path file <tt>step</tt> element also includes light source direction and path tension and bias, which do retain their meaning when used by the go-to mechanism. This can be desirable or not, and in most cases these extra attributes should simply be omitted when pasted.</p>

    <a name="labels"><h3>Planet Feature Labeling</h3></a>

    <p>Surface features may be labeled and outlined.</p>

    <img src="img/label.png">

    <p>These labellings are defined using Comma-Separated Value (CSV) files, which may be edited with most any spreadsheet program or text editor. Text is encoded using UTF8, which enables the use of accents and foreign characters. The image above shows 8990 sites acknowledged by the IAU. The first few lines of this file are as follows:</p>

    <blockquote><pre>
"Abbot",5.5157114264,54.7073670159,10404.3,1736106.29688,AA
"Abel",-34.4365372844,85.4191847678,119437.0,1734978.15625,AA
"Tiling",-52.9059642528,226.8524033223,38230.0,1733504.9375,AA
"Abenezra",-21.0078405096,11.8763800960,43188.7,1737983.65625,AA
"Perepelkin P",-12.4460507308,127.2385632171,23478.0,1740759.25,SF
</pre></blockquote>

    <p>Each line defines one feature with six attributes: the name in double quotes, the center latitude in degrees, the center longitude in degrees, the diameter of the feature in meters, distance from the center of the planet in meters, and a pair of characters giving the IAU type of the annotation, which determines how the annotation is drawn.</p>

    <table style="margin:auto;width:80%">
      <tr>
        <td><tt>AA</tt></td><td>&hellip;</td><td>Crater, drawn as a circle of the given diameter.</td>
      </tr>
      <tr>
        <td><tt>SF</tt></td><td>&hellip;</td><td>Satellite feature, drawn as a dim circle of the given diameter.</td>
      </tr>
      <tr>
        <td><tt>MO</tt></td><td>&hellip;</td><td>Mountain or range, drawn as a triangle icon</td>
      </tr>
      <tr>
        <td><tt>LF</tt></td><td>&hellip;</td><td>Landing site feature, drawn as a flag icon</td>
      </tr>
      <tr>
        <td><i>all others</i></td><td>&hellip;</td><td>Drawn with label only</td>
      </tr>
    </table>

    <p>In addition, the following additional type designations are provided, which are not recognized by the IAU. They begin with an &ldquo;at&rdquo; symbol to ensure that they don't conflict.</p>

    <table style="margin:auto;width:80%">
      <tr>
        <td><tt>@*</tt></td><td>&hellip;</td><td>Star icon</td>
      </tr>
      <tr>
        <td><tt>@C</tt></td><td>&hellip;</td><td>Circle icon</td>
      </tr>
    </table>

    <p>The diameter attribute determines the size of the label text. The radius attribute determines the altitude of the annotation, which is necessary for good alignment of small features. Do be advised that longitude and latitude values must be specified with at least five digits behind the decimal point to be correctly positioned to within one meter (on the scale of the moon). Many data sources provide less.</p>

    <p>Upon receipt of a <a href="#goto">go-to message</a>, the renderer replaces the current label set using the CSV file given by the <tt>label</tt> attribute of the <tt>step</tt> element. This may be used to mark points of interest within the defined region, such that they are automatically updated as destinations are selected.</p>

    <a name="troubleshooting"><h3>Troubleshooting</h3></a>

    <p>This is a list of issues to be aware of, should unexpected behavior arise.</p>

    <ul>
      <li><p>If the definition files are not visible in the <code>Orbiter</code> file selector, then be sure they are located within the Thumb data hierarchy, or add their location to the Thumb data hierarchy by including the path in the <tt>THUMB_RO_PATH</tt> environment variable.</p></li>

      <li><p>If the definition file loads but does not display an image, be sure the path to the SCM TIFF files appears in the <tt>SCMPATH</tt> environment variable.</p></li>

      <li><p>If performance is bad, be sure that SCM TIFF files are <em>not</em> being accessed from a network share. Also check that <tt>scm_cache_size</tt> is not too large.</p></li>

      <li><p>If the application exits unexpectedly, it will most likely have printed an error message to the standard error stream. Under Windows, this information will be redirected to the file <tt>stderr.txt</tt>. This may prove informative.</p></li>

      <li><p>If the renderer emits error messages about &ldquo;implementation limits&rdquo; on &ldquo;active samplers&rdquo; then you're probably running OS X, which places artificial limits on the usable number of texture image units. High resolution visualizations will not run. Windows and Linux do not impose these artificial limits, even on the same hardware.</p>
    </ul>

    <a name="scm"><h2>SCM TIFF</h2></a>

    <p>Planetary data sets are usually made available as a large equirectangular image files, but for real-time display, these images must be pre-processed into an optimized intermediate format that maximizes sampling uniformity across the entire sphere. This format is called a <em>spherical cube map</em> or SCM. The basic layout of an SCM resembles the cube map texture commonly used in real-time 3D graphics: it is represented by six square images, one for each face of a cube. However, while the common cube map texture maps sphere positions onto image pixels using a straightforward linear mapping, the spherical cube map uses a spherical mapping that helps equalize the solid angle subtended by each image pixel.</p>

    <p>To enable the zooming of high resolution imagery at interactive rates, each face of the spherical cube map is subdivided into a quad-tree hierarchy. To enable seamless linear magnification filtering across this discontinuous image representation, each page is stored with a 1-pixel border. Special care is taken to ensure that this border wraps correctly around the edges of the base cube.</p>

    <p>Because the resulting spherical image is represented by a number of sub-images, a multi-page image file format is required, and TIFF is chosen. Spherical cube map pages are enumerated in the TIFF file in breadth-first order, which gathers low-resolution base imagery to the front of the file and provides increasing resolution with increasing file length.</p>

    <p>The resolution of a spherical cube map image is determined by two values, the <em>size</em> of each square page in pixels, and the <em>depth</em> of the quad-tree subdivision. A spherical cube map image of depth <i>d</i> will contain 2<sup>2<i>d</i> + 3</sup> - 2 separate pages. The current renderer has a maximum depth of 7. The number of pages for several values of <i>d</i> is shown here. Note the obvious fact that a cube map with zero subdivisions has six pages.</p>

    <table id="spreadsheet">
      <tr>
        <td><i>d</i></td>
        <td>0</td>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td>4</td>
        <td>5</td>
        <td>6</td>
        <td>7</td>
      </tr>
      <tr>
        <td><i>n</i></td>
        <td>6</td>
        <td>30</td>
        <td>126</td>
        <td>510</td>
        <td>2046</td>
        <td>8190</td>
        <td>32766</td>
        <td>131070</td>
      </tr>
    </table>

    <p>A spherical cube map's page size impacts out-of-core data access performance, and values around 512 are usually best. Given a spherical cube map with page size <i>s</i> and depth <i>d</i>, the effective resolution of the equivalent equirectangular projection is 4&middot;<i>s</i>&middot;2<sup><i>d</i></sup> &times; 2&middot;<i>s</i>&middot;2<sup><i>d</i></sup>. Given a base page size of 512, the effective resolution of a spherical cube map for each depth <i>d</i> is</p>

    <table id="spreadsheet">
      <tr>
        <td><i>d</i></td>
        <td>0</td>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td>4</td>
        <td>5</td>
        <td>6</td>
        <td>7</td>
      </tr>
      <tr>
        <td><i>width</i></td>
        <td>2048</td>
        <td>4096</td>
        <td>8192</td>
        <td>16384</td>
        <td>32768</td>
        <td>65536</td>
        <td>131072</td>
        <td>262144</td>
      </tr>
      <tr>
        <td><i>height</i></td>
        <td>1024</td>
        <td>2048</td>
        <td>4096</td>
        <td>8192</td>
        <td>16384</td>
        <td>32768</td>
        <td>65536</td>
        <td>131072</td>
      </tr>
    </table>

    <p>A simple file naming convention that includes the SCM data parameters has been of great help in keeping SCM data organized. Here are a few examples:</p>

    <pre>
      WAC-426-6.tif
      LDEM-360-8.tif
      NAC_ROI_APOLLO16HIA-336-14.tif
    </pre>

    <p>The SCM TIFF image <tt>WAC-426-6.tif</tt> was generated from Lunar Reconnaissance Orbiter Wide Angle Camera imagery with a global resolution of 100 meters per pixel. Given a lunar radius of 1737400 meters, that's 108969 pixels around the equator. With size 426 and depth 6, <tt>WAC-426-6.tif</tt> has an effective resolution of 109056 &times; 54528 pixels, which is just enough to represent the source data completely. Likewise, <tt>LDEM-360-8.tif</tt> gives Lunar Digital Elevation Model data derived from the Lunar Orbiter Laser Altimeter resampled to a global resolution of 368640 &times; 184320.</p>

    <p>With a depth of 14, <tt>NAC_ROI_APOLLO16HIA-336-14.tif</tt> would appear to provide a <em>huge</em> image, however it covers only the Narrow Angle Camera Region of Interest surrounding the landing site of Apollo 16. It does give data with an SCM depth of 14, which works out to 0.5 meters per pixels, however it does so over a very small area.</p>

  </body>
</html>