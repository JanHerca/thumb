<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <style type="text/css">
    body   { margin-right: 12%;
             margin-left:  12%; text-align: justify; }
    h1     { text-align: center; padding: 1em }
    h2     { margin-left:  -9%; }
    h3     { margin-left:  -6%; }
    h4     { margin-left:  -3%; }
    h5     { margin-left:  -0%; }
  </style>
  <title>The Thumb Renderer</title>
</head>
<body>

<!---------------------------------------------------------------------------->

<center>The Design and Implementation of</center>
<h1>The Thumb Renderer</h1>

<p>The balance of the Thumb renderer is rooted in the notion that as scene complexity increases modern hardware will be batch-bound long before it is vertex-bound. For this reason, Thumb goes to great lengths to pre-transform geometry into large state-sorted render batches, even if doing so is to the detriment of visibility culling optimality. As a result, a great deal of geometry is over-specified, but this is not harmful. The total batch count is minimized, the number of state changes is minimized (since static batches may be presorted), geometry lies in a single large static VBO (resulting in minimal per-frame transfer) and vertex throughput is generally far higher than needed anyway.</p>

<h3>The scene graph</h3>

<p>To accomplish this, geometry is organized using a shallow scene graph. At the top level is a render <i>pool</i> which represents a scene as a whole. A pool consists of several <i>nodes</i>, which conceptually represent independantly movable objects. Each node consists of several <i>units</i>, which represent basic geometry components such as the contents of an OBJ model file.

<p>There is a loose correlation between this scene graph and the ODE structure associated to it. A unit corresponds to an ODE geom (the basic component of a colliding object). A node corresponds to an ODE body (an independently simulated rigid entity). A pool corresponds to an ODE world (a collection of bodies).</p>

<p>The defining characteristic of nodes and units is that nodes must be cheap to transform, while units need not be. It is the responsibility of the pool to ensure that this requirement is met while maximizing rendering efficiency. Toward this end, all of the units of a node are pretransformed to the node's coordinate system, and the resulting geometry is sorted and concatenated to form a single renderable <i>batch</i> for each material type used.</p>

<h3>Materials and batching criteria</h3>

<p>Material specification recognizes two distinct rendering modes: color mode and depth mode. Depth mode rendering is easier since lighting computation is unnecessary (so many textures may be left unbound) and some vertex attributes need not be processed. This results in greater commonality between geometry of differing material type, which leads to more opportunities to concatenate batches. For this reason, the node computes separate batch lists for depth and color modes. This depth-specific optimization is significant. Given multi-frustum shadow mapping and Z-buffer prepass rendering, more passes are made over the scene in depth mode than in color mode.</p>

<p>Material specification also recognizes two distinct geometry types: opaque and transparent. "Transparent", in this case, does not necessarily imply a see-through surface, but instead connotes the existence of a mask in the alpha channel of the diffuse texture to be rendered using alpha testing.</p>

<p>Nodes batch opaque and transparent geometry separately. Thus, there are 4 batch lists per node: opaque-color, opaque-depth, transparent-color, and transparent-depth. The purpose of this is two-fold. First, it becomes easy to insure that transparent geometry is rendered only after all opaque geometry is rendered, which is necessary for correct alpha-blending in the color buffer. Second, it maximizes the opportunity for "double-speed Z" rendering in depth mode, which is disabled when alpha-testing is enabled.</p>

<!---------------------------------------------------------------------------->

</body>
</html>